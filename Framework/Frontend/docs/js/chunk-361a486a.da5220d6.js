(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-361a486a"],{"18f6":function(t,s,e){"use strict";e("a1fe")},"3f25":function(t,s,e){"use strict";e.r(s);var i=e("7a23");const a=Object(i["gb"])("data-v-2e0265c1");Object(i["H"])("data-v-2e0265c1");const n={id:"Tip"},l=Object(i["l"])('<div class="panel-header" data-v-2e0265c1>回测结果</div><div class="panel-header-end" data-v-2e0265c1></div><svg id="Classics" class="classic" style="width:810px;height:370px;" data-v-2e0265c1></svg><div class="tooltip" data-v-2e0265c1></div><div class="tooltip2" data-v-2e0265c1></div>',5),h={class:"indexes"},r=Object(i["n"])("form",{action:"strategy=custom",method:"post",enctype:"multipart/form-data"},[Object(i["n"])("input",{class:"custom-strategy file",type:"file",name:"file"}),Object(i["n"])("input",{class:"custom-strategy upload",type:"submit",value:"Upload"})],-1),c={class:"content-left"},o=Object(i["n"])("div",{class:"seg"},null,-1),u={class:"nav"},d={class:"nav-menu"},p=Object(i["n"])("div",{class:"nav-title"},"经典策略",-1),g={class:"nav-content"};Object(i["F"])();const v=a((t,s,e,a,v,b)=>(Object(i["E"])(),Object(i["i"])(i["b"],null,[Object(i["n"])("div",n,[l,Object(i["db"])(Object(i["n"])("input",{class:"asset-code",type:"text","onUpdate:modelValue":s[1]||(s[1]=t=>v.asset_code=t),placeholder:"Input Asset Code"},null,512),[[i["Y"],v.asset_code,void 0,{lazy:!0}]]),Object(i["db"])(Object(i["n"])("input",{class:"time-start",type:"text","onUpdate:modelValue":s[2]||(s[2]=t=>v.start_time=t),placeholder:"Input Start Time"},null,512),[[i["Y"],v.start_time,void 0,{lazy:!0}]]),Object(i["db"])(Object(i["n"])("input",{class:"time-end",type:"text","onUpdate:modelValue":s[3]||(s[3]=t=>v.end_time=t),placeholder:"Input End Time"},null,512),[[i["Y"],v.end_time,void 0,{lazy:!0}]]),Object(i["db"])(Object(i["n"])("input",{class:"time-frequency",type:"text","onUpdate:modelValue":s[4]||(s[4]=t=>v.frequency=t),placeholder:"Input Frequency"},null,512),[[i["Y"],v.frequency,void 0,{lazy:!0}]]),Object(i["n"])("div",{class:"time-button",onClick:s[5]||(s[5]=t=>b.backtest()),type:"submit"},"Backtest"),Object(i["n"])("div",h,"最大回撤："+Object(i["R"])(v.retreat),1),r]),Object(i["n"])("div",c,[o,Object(i["n"])("div",u,[Object(i["n"])("div",d,[p,Object(i["n"])("div",g,[Object(i["n"])("a",{id:"R-breaker",onClick:s[6]||(s[6]=t=>b.getStrategy("R_breaker"))},"R-breaker"),Object(i["n"])("a",{id:"ATR",onClick:s[7]||(s[7]=t=>b.getStrategy("ATR"))},"ATR"),Object(i["n"])("a",{id:"Dual Thrust",onClick:s[8]||(s[8]=t=>b.getStrategy("Dual_Thrust"))},"Dual Thrust")])])])])],64)));var b=e("bc3a"),m=e.n(b),T=e("5698"),f={name:"Backtest",data(){return{asset:[],retreat:"",investvalue:[],TR:[],ATR_param:{k:10,N:20},DT_param:{k:5},ATR_bounds:[],Unit:[],width:780,height:330,margin:{top:40,right:20,bottom:10,left:55},r:10,c:20,asset_code:"",start_time:"",end_time:"",frequency:"",strategy:"",flag:0}},mounted(){},computed:{innerWidth(){return this.width-this.margin.left-this.margin.right},innerHeight(){return this.height-this.margin.top-this.margin.bottom}},methods:{trial(){this.flag+=1,console.log(this.flag)},getStrategy(t){this.strategy=t},backtest(){const t="http://127.0.0.1:5000/"+this.asset_code+"/st="+this.start_time+"ed="+this.end_time+"freq="+this.frequency+"/strategy="+this.strategy;m.a.get(t).then(t=>{this.asset=t.data,console.log(this.asset)}).catch(t=>{console.error(t)}),console.log(this.asset)},getAsset(){const t="http://127.0.0.1:5000/Sample/A";m.a.get(t).then(t=>{this.asset=t.data,console.log(this.asset),this.flag+=1,console.log(this.flag)}).catch(t=>{console.error(t)})},getATR(){let t=0;while(t<this.asset.length)this.TR.push(Math.max(this.asset[t]["high"]-this.asset[t]["low"],Math.abs(this.asset[t]["high"]-this.asset[t]["PDC"]),Math.abs(this.asset[t]["PDC"]-this.asset[t]["low"]))),t+=1;console.log(this.TR),t=0;while(t<this.asset.length){if(t>=this.ATR_param.k)if(t>=this.ATR_param.N-1){let s={};s["Up"]=T["k"](this.asset.slice(t-this.ATR_param.k,t),(function(t){return t["high"]})),s["Down"]=T["m"](this.asset.slice(t-this.ATR_param.k,t),(function(t){return t["low"]})),s["ATR"]=T["l"](this.TR.slice(t-this.ATR_param.N+1,t+1)),this.ATR_bounds.push(s)}else{let s={};s["Up"]=T["k"](this.asset.slice(t-this.ATR_param.k,t),(function(t){return t["high"]})),s["Down"]=T["m"](this.asset.slice(t-this.ATR_param.k,t),(function(t){return t["low"]})),s["ATR"]=0,this.ATR_bounds.push(s)}else if(t>=this.ATR_param.N-1){let s={Up:0,Down:0};s["ATR"]=T["l"](this.asset.slice(t-this.ATR_param.N+1,t+1)),this.ATR_bounds.push(s)}else{let t={Up:0,Down:0,ATR:0};this.ATR_bounds.push(t)}t+=1}console.log(this.ATR_bounds),t=0;while(t<this.ATR_bounds.length)this.Unit.push(0),t+=1;t=0;let s=this.asset[0]["current"];while(t<this.ATR_bounds.length)0==t?this.asset[t]["current"]>this.ATR_bounds[t]["Up"]?(s=this.asset[t]["current"],this.Unit[t]+=1):this.asset[t]["current"]<this.ATR_bounds[t]["Down"]&&(s=this.asset[t]["current"],this.Unit[t]-=1):(0==this.Unit[t-1]&&(this.asset[t]["current"]>this.ATR_bounds[t]["Up"]?(s=this.asset[t]["current"],this.Unit[t]=this.Unit[t-1]+1):this.asset[t]["current"]<this.ATR_bounds[t]["Down"]&&(s=this.asset[t]["current"],this.Unit[t]=this.Unit[t-1]-1)),this.Unit[t-1]>0&&(this.asset[t]["current"]>s+.5*this.ATR_bounds[t]["ATR"]?(this.Unit[t]=this.Unit[t-1]+1,s=this.asset[t]["current"]):(this.asset[t]["current"]<s-2*this.ATR_bounds[t]["ATR"]||this.asset[t]["current"]<this.ATR_bounds[t]["Down"])&&(this.Unit[t]=0)),this.Unit[t-1]<0&&(this.asset[t]["current"]<s-.5*this.ATR_bounds[t]["ATR"]?(this.Unit[t]=this.Unit[t-1]-1,s=this.asset[t]["current"]):(this.asset[t]["current"]>s+2*this.ATR_bounds[t]["ATR"]||this.asset[t]["current"]>this.ATR_bounds[t]["Up"])&&(this.Unit[t]=0))),t+=1;console.log(this.Unit),t=0;while(t<this.asset.length)0==t?this.investvalue.push(this.asset[t]["current"]*this.Unit[t]):this.investvalue.push(this.investvalue[t-1]+this.asset[t]["current"]*this.Unit[t]),t+=1;console.log(this.investvalue)},getInvestvalue(){console.log("getinvest");let t=0;while(t<this.asset.length)this.investvalue.push(this.asset[t]["total_cash"]),t+=1;console.log(this.investvalue)},Scale(){T["q"]("#classicscale").remove();const t=T["q"]("#Classics").append("g").attr("id","classicscale").attr("transform",`translate(${this.margin.left},${this.margin.top})`);var[s,e]=T["e"](this.investvalue);let i=this;const a=T["p"]().domain([0,i.investvalue.length]).range([0,this.innerWidth]),n=T["p"]().domain([e,s]).range([0,this.innerHeight]);console.log([s,e]);const l=T["b"](n).ticks(10).tickSize(5).tickPadding(5),h=T["a"](a).ticks(20).tickSize(-5).tickPadding(-15).tickFormat((function(t){return t<i.asset.length?i.asset[t]["date"].slice(5,10):i.asset[t-1]["date"].slice(5,10)}));t.append("g").call(l).attr("id","yaxis"),t.append("g").call(h).attr("id","xaxis"),T["q"]("#xaxis").selectAll(".tick").selectAll("text").attr("font-size","9px")},Draw(){T["q"]("#classicCurve").remove();const t=T["q"]("#Classics").append("g").attr("id","classicCurve").attr("transform",`translate(${this.margin.left},${this.margin.top})`);let s=this;s.flag="ATR";var[e,i]=T["e"](this.investvalue);const a=T["p"]().domain([0,s.investvalue.length]).range([0,this.innerWidth]),n=T["p"]().domain([i,e]).range([0,this.innerHeight]),l=T["j"]().x((function(t,s){return a(s)})).y((function(t){return n(t)})).curve(T["d"]);t.append("path").attr("d",l(s.investvalue)).attr("fill","none").attr("stroke","#3366ff")},DT(){T["q"]("#classicCurve").remove(),console.log("Dual Thrust")},colorbox(t,s,e){var[i,a]=T["e"](e.domain()),n=T["n"](i,a,(a-i)/s[1]),l=T["p"]().domain([i,a]).range([0,s[1]]);t.selectAll("line").data(n).enter().append("line").attr("x1",0).attr("x2",s[0]).attr("y1",l).attr("y2",l).attr("stroke",e),t.append("rect").attr("width",s[0]).attr("height",s[1]).attr("fill","none").attr("stroke","black")}},created(){},beforeUnmount(){},watch:{asset(){this.getInvestvalue(),this.retreat=T["k"](this.asset,(function(t){return t["retreat"]})).toFixed(2),this.Scale(),this.Draw()}}},R=(e("18f6"),e("6b0d")),A=e.n(R);const _=A()(f,[["render",v],["__scopeId","data-v-2e0265c1"]]);s["default"]=_},a1fe:function(t,s,e){}}]);
//# sourceMappingURL=chunk-361a486a.da5220d6.js.map