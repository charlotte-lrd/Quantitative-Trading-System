{"remainingRequest":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\babel-loader\\lib\\index.js!D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\vue-loader-v16\\dist\\templateLoader.js??ref--6!D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\src\\components\\Overview.vue?vue&type=template&id=6408adae","dependencies":[{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\src\\components\\Overview.vue","mtime":1657000431400},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657630378692},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\babel-loader\\lib\\index.js","mtime":1657630379770},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1657630376233},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657630378692},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1657630374383}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY3JlYXRlVk5vZGUgYXMgX2NyZWF0ZVZOb2RlLCBvcGVuQmxvY2sgYXMgX29wZW5CbG9jaywgY3JlYXRlQmxvY2sgYXMgX2NyZWF0ZUJsb2NrIH0gZnJvbSAidnVlIjsKdmFyIF9ob2lzdGVkXzEgPSB7CiAgaWQ6ICJhbGwiCn07Cgp2YXIgX2hvaXN0ZWRfMiA9IC8qI19fUFVSRV9fKi9fY3JlYXRlVk5vZGUoImRpdiIsIHsKICBjbGFzczogInBhbmVsLWhlYWRlciIKfSwgIk92ZXJ2aWV3IiwgLTEKLyogSE9JU1RFRCAqLwopOwoKdmFyIF9ob2lzdGVkXzMgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZVZOb2RlKCJkaXYiLCB7CiAgY2xhc3M6ICJwYW5lbC1oZWFkZXItZW5kIgp9LCBudWxsLCAtMQovKiBIT0lTVEVEICovCik7Cgp2YXIgX2hvaXN0ZWRfNCA9IC8qI19fUFVSRV9fKi9fY3JlYXRlVk5vZGUoImRpdiIsIHsKICBjbGFzczogInRvb2x0aXAxIgp9LCBudWxsLCAtMQovKiBIT0lTVEVEICovCik7CgpleHBvcnQgZnVuY3Rpb24gcmVuZGVyKF9jdHgsIF9jYWNoZSwgJHByb3BzLCAkc2V0dXAsICRkYXRhLCAkb3B0aW9ucykgewogIHJldHVybiBfb3BlbkJsb2NrKCksIF9jcmVhdGVCbG9jaygiZGl2IiwgX2hvaXN0ZWRfMSwgW19ob2lzdGVkXzIsIF9ob2lzdGVkXzMsIChfb3BlbkJsb2NrKCksIF9jcmVhdGVCbG9jaygic3ZnIiwgewogICAgaWQ6ICJPdmVydmlldyIsCiAgICBzdHlsZTogewogICAgICAid2lkdGgiOiAiODA1cHgiLAogICAgICAiaGVpZ2h0IjogIjI1MHB4IgogICAgfSwKICAgIG9uTW91c2Vkb3duOiBfY2FjaGVbMV0gfHwgKF9jYWNoZVsxXSA9IGZ1bmN0aW9uICgkZXZlbnQpIHsKICAgICAgcmV0dXJuICRvcHRpb25zLnJlQ29sb3IoImRvd24iKTsKICAgIH0pCiAgfSwgbnVsbCwgMzIKICAvKiBIWURSQVRFX0VWRU5UUyAqLwogICkpLCBfaG9pc3RlZF80XSk7Cn0="},{"version":3,"sources":["D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\src\\components\\Overview.vue"],"names":[],"mappings":";;AACO,EAAA,EAAE,EAAC;;;8BACN,YAAA,CAAwC,KAAxC,EAAwC;AAAnC,EAAA,KAAK,EAAC;AAA6B,CAAxC,EAA0B,UAA1B,EAAkC,CAAA;AAAA;AAAlC,C;;8BACA,YAAA,CAAoC,KAApC,EAAoC;AAA/B,EAAA,KAAK,EAAC;AAAyB,CAApC,EAA6B,IAA7B,EAA6B,CAAA;AAAA;AAA7B,C;;8BAIA,YAAA,CAA4B,KAA5B,EAA4B;AAAvB,EAAA,KAAK,EAAC;AAAiB,CAA5B,EAAqB,IAArB,EAAqB,CAAA;AAAA;AAArB,C;;;uBANF,YAAA,CAOM,KAPN,EAAA,UAAA,EAOM,CANJ,UAMI,EALJ,UAKI,G,cAJJ,YAAA,CAEM,KAFN,EAEM;AAFD,IAAA,EAAE,EAAG,UAEJ;AAFe,IAAA,KAAmC,EAAnC;AAAA,eAAA,OAAA;AAAA,gBAAA;AAAA,KAEf;AADJ,IAAA,WAAS,EAAA,MAAA,CAAA,CAAA,CAAA,KAAA,MAAA,CAAA,CAAA,CAAA,GAAA,UAAA,MAAA;AAAA,aAAI,QAAA,CAAA,OAAA,CAAO,MAAP,CAAJ;AAAA,KAAA;AACL,GAFN,E,IAAA,E;;AAAA,GAII,GADJ,UACI,CAPN,C","sourcesContent":["<template>\n  <div id=\"all\">\n    <div class=\"panel-header\">Overview</div>\n    <div class=\"panel-header-end\"></div>\n    <svg id = \"Overview\" style = 'width:805px; height:250px'\n     @mousedown = 'reColor(\"down\")'>\n    </svg> \n    <div class=\"tooltip1\"></div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport * as d3 from 'd3'\n\nexport default {\n  name:'Overview',\n  data(){\n\n    return {\n      all:[],\n      width: 800,//1220,\n      height: [21],\n      margin:{\n        top:0,\n        right:80,\n        bottom:0,\n        left:60\n      },\n      r:15,\n      c:15,\n      MONTHS:['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November','December']\n\n    };\n  },\n  mounted(){\n    //this.Scale();\n  },\n  computed:{\n    time(){\n      var t = new Date();\n      var m = t.getTime();\n      return m;\n    },\n    all_data(){\n      return this.all\n    },\n    innerWidth(){\n      return this.width - this.margin.left - this.margin.right\n    },\n    innerHeight(){\n      return this.height[this.height.length-1] - this.margin.top - this.margin.bottom\n    },\n    day(){\n      let day = this.all\n      day.forEach(d =>{\n        d[\"date\"] = new Date(d['day']).getDate();\n        d[\"month\"] = new Date(d['day']).getMonth();\n        d[\"year\"] = new Date(d['day']).getFullYear();\n    })\n    return day\n    },\n    dayData(){\n        let dayDatas=[[],[],[]]\n        dayDatas[0] = this.day.filter(d =>{\n                return d[\"year\"]==2020;\n        })\n        dayDatas[1] = this.day.filter(d =>{\n                return d[\"year\"]==2021;\n        })\n        dayDatas[2] = this.day.filter(d =>{\n                return d[\"year\"]==2022;\n        })\n      return dayDatas;\n    }\n  },\n  methods:{\n     getAll(){\n       const path = 'http://127.0.0.1:5000/Overview';\n       axios\n         .get(path)\n         .then(res => {\n           this.all=res.data;\n         })\n         .catch(error => {\n           console.error(error);\n         });\n     },\n \n  Color(num){\n    let that = this;\n    const [a,b] = d3.extent(that.day, function(d){return d['canonical'];})\n    const color =d3.scaleDivergingSymlog([a,0.8*a+0.2*b,b], function(t){return d3.interpolateYlOrRd(t);})\n    return color(num)\n  },\n  // Color_select(num){\n  //   let that = this;\n  //   const [a,b] = d3.extent(that.day, function(d){return d['canonical'];})\n  //   const color =d3.scaleDivergingSymlog([a,0.8*a+0.2*b,b], function(t){return d3.interpolateGreens(t);})\n  //   return color(num)\n  // },\n  reColor(action){\n    let that = this;\n    if(action==\"down\"){\n      console.log(\"recolor\")\n      for(let i = 0; i < that.dayData.length;i++){\n        d3.select(\"#Overview\").select(\"#overview\"+eval(i))\n          .selectAll(\"rect\")\n          .attr(\"fill\", d=>that.Color(d['canonical']))\n          .attr(\"stroke\",\"\")\n                }\n    }\n\n  },\n  Draw(k){\n    let that = this;\n\n   \n    var rawdeposits = [];\n\n    var allmonths = Array.from(new Set(that.dayData[k].map(d => {\n            return d[\"month\"];\n          })));\n            \n    allmonths.forEach(function() {\n            let b = [];\n            for(let i =0; i<31;i++){ b.push([]);}\n            rawdeposits.push(b);\n            })\n    var deposits = rawdeposits\n\n    that.dayData[k].forEach(d => {\n            for (let i = 0;i < d[\"deposits\"].length; i++){\n            deposits[allmonths.indexOf(d['month'])][d[\"date\"]-1].push(d[\"deposits\"][i]);\n    }})\n\n    var svg = d3.select('#Overview');\n    const g = svg.append('g').attr(\"id\",\"overview\" + k)\n                 .attr('transform', `translate(${that.margin.left},${d3.sum(that.height)+8*k})`);\n\n    const xscale = d3.scaleLinear()\n    .domain([0,31])\n    .range([0, that.innerWidth]);\n\n    //that.height.push(25 * allmonths.length)\n    that.height.push(13 * allmonths.length)\n\n    const yscale = d3.scaleBand()\n                     .domain(allmonths.map(d => that.MONTHS[d]))\n                     .range([0, that.innerHeight])\n\n    const yaxis = d3.axisLeft(yscale)\n\n    const xaxis = d3.axisTop(xscale)\n                    .ticks(31)\n                    .tickPadding(5)\n                    .tickSize(4)\n                    .tickFormat(function(d,i){\n                      if(k==0)\n                        return i\n                      return \"\"\n                    })\n\n    g.append('g').call(yaxis).attr('id' ,'yaxis');\n\n    g.append('g').call(xaxis).attr('id', 'xaxis');\n\n    g.select(\"#yaxis\").selectAll(\"text\").attr(\"font-size\",\"8px\")\n\n    let rectwid = 17\n    let rectheight = 10\n    g.selectAll('.datarect'+ k).data(that.dayData[k]).enter().append('rect')\n     .attr('class', 'datarect'+k)\n     .attr('width', rectwid)\n     .attr('height', rectheight)\n     .attr('y', function(d){return yscale.step()*(allmonths.indexOf(d['month'])+0.5) - rectheight/2 }) \n     .attr('x', d => (xscale(d['date'])-rectwid/2))\n     .attr('fill', d => that.Color(d[\"canonical\"]))\n     .attr('opacity', 0.9)\n     .on(\"mouseup\", function(){\n          // d3.select(this)\n          //   .attr(\"fill\", \"#FFFF00\")\n          //   .attr(\"stroke\",\"#FF8BA0\")\n          //   .attr(\"stroke-width\",\"1.5px\");//d=>that.Color_select(d['canonical']))\n          var temp = d3.select(this).data();\n          let a = temp[0]['day'];\n          let b = \"2020-12-01\";\n          const epoch_num = 225*(new Date(a) - new Date(b))/(1*24*60*60*1000)\n          that.$emit('day_detail',epoch_num);\n          console.log(\"highlight\")\n          var str1 = a + \"<br>Epoch \" + epoch_num + \" ~ \" + (epoch_num + 225)\n          console.log(a)\n            d3.selectAll('.tooltip1')\n              .html(str1)\n              .style(\"opacity\",1.0)\n\n          })     \n\n    for (let i = 0; i < deposits.length; i++) {\n      for (let j = 0; j < deposits[i].length; j++) {\n        const xscale20 = d3.scaleLinear()\n                           .domain([0,254])\n                           .range([0, rectwid]);\n\n        const yscale20 = d3.scaleLinear()\n                           .domain([300,0])\n                          //  .domain([d3.max(deposits[i][j],function(d){return d}),d3.min(deposits[i][j],function(d){return d})])\n                           .range([0, rectheight]);\n\n        var [h,q] = d3.extent(d3.filter(deposits[i][j],x=>x>1),function(d){return d})\n        const z = d3.scaleLinear()\n          //.domain([d3.min(deposits[i][j],function(d){return d}),d3.max(deposits[i][j],function(d){return d})])\n           //.domain([0,400])\n                    .domain([h,q])\n                    .range([1,4]);\n\n\n          d3.select('#overview'+k).append('g')\n            .attr('transform', function () {\n                return `translate(${xscale(j+1)-rectwid/2},${yscale.step()*(i+0.5) - rectheight/2})`;\n                })\n            .selectAll(\"dot\")\n            .data(deposits[i][j])\n            .enter()\n            .append(\"circle\")\n            .attr(\"cx\", function (d,i) {return xscale20(i);} )\n            .attr(\"cy\", yscale20(150))\n            .attr(\"r\", function (d) { return d==1?0:z(d); } )\n            .style(\"fill\", \"#014040\")\n            .style(\"opacity\", 0.6 )\n        }\n      }\n\n    // for (let i = 0; i < deposits.length; i++) {\n    //   for (let j = 0; j < deposits[i].length; j++) {\n    //     const xscale20 = d3.scaleLinear()\n    //                        .domain([0,254])\n    //                        .range([0, rectwid]);\n    //     const yscale20 = d3.scaleLinear()\n    //                        .domain([d3.max(deposits[i][j],function(d){return d}),d3.min(deposits[i][j],function(d){return d})])\n    //                        .range([0, rectheight]);\n    //     const line0 = d3.line()\n    //                     .x(function (d,i) {return xscale20(i);})\n    //                     .y(function (d) {return yscale20(d);});\n    //     d3.select('#overview'+k).append('g')\n    //       .attr('transform', function () {\n    //       return `translate(${xscale(j+1)-rectwid/2},${yscale.step()*(i+0.5) - rectheight/2})`;\n    //       })\n    //       .append('path')\n    //       .datum(deposits[i][j])\n    //       .attr('class', 'linestyle')\n    //       .attr(\"fill\", \"none\")\n    //       .attr(\"stroke\", \"brown\")\n    //       .attr(\"stroke-width\", 0.5)\n    //       .attr(\"d\", line0)\n    //     }\n    //   }\n\n      \n    },\n    \n  Legend(){\n    let that = this;\n    var [a,b] = d3.extent(that.day, function(d){return d['canonical'];})\n\n    d3.select(\"#Overview\")\n      .append(\"g\").attr(\"id\",\"legend_overview\")\n      .call(that.colorbox,[10,150],d3.scaleDivergingSymlog([a,0.8*a+0.2*b,b], function(t){return d3.interpolateYlOrRd(t);}))\n      .attr(\"transform\",`translate(${22+that.width - that.margin.right},${30})`)\n\n    d3.select(\"#legend_overview\")\n       .append(\"g\")\n       .call(d3.axisRight(d3.scaleLinear().domain([b,a]).range([150,0])).ticks(5))\n       .attr(\"transform\",\"translate(10,0)\")\n    d3.select(\"#legend_overview\") \n      .append(\"text\")\n      .text(\"Missed Blocks\")\n      .attr(\"transform\",\"translate(-12,-10)\")\n      .attr(\"font-size\",\"10px\")\n  },\n  colorbox(sel, size, colors){\n    var [x0,x1] = d3.extent( colors.domain());\n    var bars = d3.range( x0, x1, (x1-x0)/size[1]);\n    var sc = d3.scaleLinear()\n        .domain([x0,x1]).range([0, size[1]]);\n    sel.selectAll(\"line\").data(bars).enter().append(\"line\")\n      .attr(\"x1\", 0).attr(\"x2\",size[0])\n      .attr(\"y1\", sc).attr(\"y2\",sc)\n      .attr(\"stroke\",colors);\n    \n    sel.append(\"rect\")\n        .attr(\"width\",size[0]).attr(\"height\",size[1])\n        .attr(\"fill\",\"none\").attr(\"stroke\",\"black\")\n      }\n  },\n  created(){\n    this.getAll();\n},\n  watch:{\n    all_data(){\n      for(let i=0; i < this.dayData.length; i++){\n        this.Draw(i);\n      }\n      this.Legend();\n    },\n    time(){\n      console.log(1)\n    }\n  }\n};\n</script>\n\n<style>\n.tooltip1{\n  position:absolute;\n  stroke:black;\n  left:740px;\n  top:206px;\n  width:auto;\n  height:auto;\n  border:2px solid lightcoral;\n  border-radius:5px;\n  padding-left:1px;\n  padding-right:1px;\n  padding-top:1px;\n  padding:1px;\n  background-color: white;\n  font-size: 1px;\n  text-align: center;\n  opacity:0;\n  z-index:99;\n}\n.panel-header {\n  position: absolute;\n  left:0px;\n  top:0px;\n  padding: 0 8px;\n  width: 45px;\n  height: 18px;\n  line-height: 18px;\n  font-size: 8px;\n  background: #415c68;\n  color: #fcfcfc;\n  display: flex;\n  font-weight: bold;\n  border-radius: 2px;\n  box-shadow: 0 1px 2px rgba(26 26 26 0.2);\n  z-index:99;\n  text-align: left;\n}\n\n.panel-header-end {\n  position: absolute;\n  top: 0px;\n  left: 60.5px;\n  border-top: 18px solid #455a64;\n  border-right: 18px solid #ffffff;\n  border-bottom: 0px solid #ffffff;\n  z-index:98;\n}\n</style>\n"],"sourceRoot":""}]}