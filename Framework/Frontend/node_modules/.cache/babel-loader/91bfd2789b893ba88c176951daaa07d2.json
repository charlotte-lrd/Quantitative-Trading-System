{"remainingRequest":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\babel-loader\\lib\\index.js!D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\vue-loader-v16\\dist\\templateLoader.js??ref--6!D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\vue-loader-v16\\dist\\index.js??ref--0-1!D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\src\\components\\Validator.vue?vue&type=template&id=9679eb5c","dependencies":[{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\src\\components\\Validator.vue","mtime":1657000431416},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657630378692},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\babel-loader\\lib\\index.js","mtime":1657630379770},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\vue-loader-v16\\dist\\templateLoader.js","mtime":1657630376233},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1657630378692},{"path":"D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1657630374383}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY3JlYXRlVk5vZGUgYXMgX2NyZWF0ZVZOb2RlLCBvcGVuQmxvY2sgYXMgX29wZW5CbG9jaywgY3JlYXRlQmxvY2sgYXMgX2NyZWF0ZUJsb2NrIH0gZnJvbSAidnVlIjsKCnZhciBfaG9pc3RlZF8xID0gLyojX19QVVJFX18qL19jcmVhdGVWTm9kZSgiZGl2IiwgewogIGNsYXNzOiAicGFuZWwtaGVhZGVyX3ZhbCIKfSwgIlZhbGlkYXRvclZpZXciLCAtMQovKiBIT0lTVEVEICovCik7Cgp2YXIgX2hvaXN0ZWRfMiA9IC8qI19fUFVSRV9fKi9fY3JlYXRlVk5vZGUoImRpdiIsIHsKICBjbGFzczogInBhbmVsLWhlYWRlci1lbmRfdmFsIgp9LCBudWxsLCAtMQovKiBIT0lTVEVEICovCik7Cgp2YXIgX2hvaXN0ZWRfMyA9IC8qI19fUFVSRV9fKi9fY3JlYXRlVk5vZGUoInN2ZyIsIHsKICBpZDogIlZhbGlkYXRvciIsCiAgc3R5bGU6IHsKICAgICJ3aWR0aCI6ICI0MzVweCIsCiAgICAiaGVpZ2h0IjogIjMxNXB4IgogIH0KfSwgbnVsbCwgLTEKLyogSE9JU1RFRCAqLwopOwoKdmFyIF9ob2lzdGVkXzQgPSAvKiNfX1BVUkVfXyovX2NyZWF0ZVZOb2RlKCJkaXYiLCB7CiAgY2xhc3M6ICJ0b29sdGlwMyIKfSwgbnVsbCwgLTEKLyogSE9JU1RFRCAqLwopOwoKZXhwb3J0IGZ1bmN0aW9uIHJlbmRlcihfY3R4LCBfY2FjaGUsICRwcm9wcywgJHNldHVwLCAkZGF0YSwgJG9wdGlvbnMpIHsKICByZXR1cm4gX29wZW5CbG9jaygpLCBfY3JlYXRlQmxvY2soImRpdiIsIG51bGwsIFtfaG9pc3RlZF8xLCBfaG9pc3RlZF8yLCBfaG9pc3RlZF8zLCBfaG9pc3RlZF80XSk7Cn0="},{"version":3,"sources":["D:\\复旦大二暑假\\暑研\\Eth2.0-Vis-main\\Eth2.0-Vis-main\\vue-template\\src\\components\\Validator.vue"],"names":[],"mappings":";;8BAEI,YAAA,CAAiD,KAAjD,EAAiD;AAA5C,EAAA,KAAK,EAAC;AAAsC,CAAjD,EAA8B,eAA9B,EAA2C,CAAA;AAAA;AAA3C,C;;8BACA,YAAA,CAAwC,KAAxC,EAAwC;AAAnC,EAAA,KAAK,EAAC;AAA6B,CAAxC,EAAiC,IAAjC,EAAiC,CAAA;AAAA;AAAjC,C;;8BACA,YAAA,CACM,KADN,EACM;AADD,EAAA,EAAE,EAAG,WACJ;AADgB,EAAA,KAAmC,EAAnC;AAAA,aAAA,OAAA;AAAA,cAAA;AAAA;AAChB,CADN,E,IAAA,E;;AAAA,C;;8BAEA,YAAA,CAA4B,KAA5B,EAA4B;AAAvB,EAAA,KAAK,EAAC;AAAiB,CAA5B,EAAqB,IAArB,EAAqB,CAAA;AAAA;AAArB,C;;;uBALF,YAAA,CAMM,KANN,EAMM,IANN,EAMM,CALJ,UAKI,EAJJ,UAII,EAHJ,UAGI,EADJ,UACI,CANN,C","sourcesContent":["<template>\n  <div>\n    <div class=\"panel-header_val\">ValidatorView</div>\n    <div class=\"panel-header-end_val\"></div>\n    <svg id = \"Validator\" style = 'width:435px; height:315px'>\n    </svg>\n    <div class=\"tooltip3\"></div>\n  </div>\n</template>\n\n<script>\nimport axios from 'axios'\nimport * as d3 from 'd3'\n\nexport default {\n  name:'Validator',\n  props:[\"msg\"],\n  data(){\n    return {\n      val:[],\n      proposer:[],\n      width: 435,\n      height: 321,\n      margin:{\n        top:5,\n        right:0,\n        bottom:45,\n        left:0\n        \n      }\n    \n    };\n  },\n  mounted(){\n\n  },\n  computed:{\n    message(){\n      console.log(this.msg);\n      return this.msg;\n    },\n    vali(){\n      return this.val;\n    },\n    innerWidth(){\n      return this.width - this.margin.left - this.margin.right\n    },\n    innerHeight(){\n      return this.height - this.margin.top - this.margin.bottom\n    }\n  },\n  methods:{\n    getValidator(){\n      // const path = 'http://127.0.0.1:5000/validator/' + eval(this.msg);\n      var path = '';\n      if(eval(this.msg) == 32533){\n        path = 'http://127.0.0.1:5000/Validator_Attack/' + eval(this.msg);\n      }else{\n        path = 'http://127.0.0.1:5000/validator/' + eval(this.msg);\n      }\n      console.log(path);\n      axios\n        .get(path)\n        .then(res => {\n          console.log(res);\n          this.val=res.data[0];\n          this.proposer = res.data[1]\n        })\n        .catch(error => {\n          console.error(error);\n        });\n\n    },\n\n    data_processing(){\n   const     slashed_slot=[6668,22373,40771,138163,138730,140312,140558,140810,140844,140894,141173,248185,343132,476903,1510278\n  ,1856962,3339590,17090,17090,17090,17091,17091,17092,17090,17091,17091,17091,43917,102388,118135,138163,138163,138163,138730,\n  140894,140894,138163,138730,456995,457540,231180,256809,296752,357059,421394,456865,456873,456869,456875,456930,456931,456929,\n  456928,457443,457540,457537,457537,457538,457541,457542,457541,457537,457540,457537,457536,457539,457540,457536,457539,457541,\n  457536,457537,457542,457541,457536,457536,457536,457541,457536,457539,457536,457539,457536,475779,457537,457538,457537,457537,\n  457540,2755552,457538,457539,457541,457538,457540,2812800,2813960,457536,457536,457542,457539,457540,457537,457539,457537,457540,\n  457536,457542,457536,457539,457536,457540,457541,457541,457537,457538,457542,457536,457542,457536,457541,457542,475780,475778,475777,\n  475776,475780,475779,475776,475776,475780,475780,475776,475779,475776,475777,475778,475776,906880,1003553,1130720,1224987,1232591,1322720,\n  1322969,1348326,1376000,1376000,1379970,1381593,1899680,1956769,1956779,1978690,2008347,2029832,2043488,2176001,2176737,2176801,2332096,\n  2535250,2624390,2638205,2724283,2814144,2814432,2834208,2872459,3065149,3360800];\n  const  slashed_V=[20075,18177,25645,38069,38089,38130,38129,38065,38128,38117,38114,45871,40892,63338,169440,21613,19299,21574,4259,\n    4100,4390,4086,4102,4110,13869,18249,4451,7635,1644,23241,38105,38061,38061,38091,38148,38106,38058,38116,14415,71603,43843,52866,\n    57976,38038,9143,8320,8275,8250,8239,16509,16491,16523,16479,17377,71676,71654,69812,71401,69884,71665,68648,69358,69895,71614,75715,\n    71690,75162,69391,69817,69716,71664,69732,71671,69772,69841,71673,71708,69866,71699,71663,69809,69388,69756,17189,71593,71646,69786,\n    68593,72074,203983,72499,69717,70044,71672,71709,88656,88655,71718,72084,71714,71734,71744,72081,72082,72421,72491,72493,72496,72503,\n    72508,72511,72674,72807,75045,75172,75204,75212,75711,75723,71743,75699,69873,17395,18989,19001,24696,26278,26201,17164,17228,17304,\n    17140,24703,23179,17291,24528,19017,17232,73292,66420,8776,3206,100190,67319,119315,26447,25895,25894,25893,12981,78678,161751,161752,\n    9230,27442,45276,26945,26988,26989,26987,42708,261,1859,12697,12954,88632,88657,39710,62830,270651,66065];\n    const g = d3.select(\"#Validator\").append('g')\n      .attr('transform', `translate(${this.margin.left},${this.margin.top})`);\n      \n      \n\n\nlet that = this;\n\n// console.log(\"WZH\",that.val[0]);\n\nfor(let j=that.val[that.val.length-1].validator.length-1;j>0&&that.val[that.val.length-1].validator[j].vote==-2;j--)\n\nfor(let i=0;i<that.val.length;i++){\n    that.val[i].validator.splice(j,1);\n}\n\nthat.val.reverse();\nthat.proposer.reverse();\n\n\n const SUM=that.val[0].validator.length;\nconsole.log(SUM);\n\n\n var graph = [];\n var v_line = [];\n for(let i=0; i < SUM; i++)\n   v_line.push({index:that.val[0].validator[i].validator_index,node:[]});\n for(let i=0;i<that.val.length;i++){\n    graph.push([]);\n    for(let j=0;j<2;j++){\n        graph[i].push(0);\n    }\n }\n//处理 被slashed的数据\nvar slashed=[];\n\nfor(let i=0;i<slashed_slot.length;i++){\n  slashed.push({slot:slashed_slot[i],V_index:slashed_V[i]});\n}\nslashed.sort((x,y)=>{\n  return x.V_index-y.V_index;\n})\n// console.log(slashed);\n //graph保留数量信息\nvar k = []\nfor(let i = 0;i < that.proposer.length; i++)\n k.push(0);\nfor(let j = 0; j < SUM; j++){\n  for(let i = 0; i < that.val.length; i++){\n   while(k[i] < that.proposer[i].length && that.val[i].validator[j].validator_index>that.proposer[i][k[i]])\n        k[i]++;\n    var Y=that.val[i].validator[j].vote+1;\n    // if(Y==-1)\n    //    console.log(i,j);\n    if(Y<2){\n    if(Y<0)\n        Y=0;\n    var X= ++graph[i][Y];\n    v_line[j].node.push( {dy:X,y:Y,ispro:0,isslashed:0});\n    }\n    else{\n     v_line[j].node.push( {dy:0,y:2,ispro:0,isslashed:0})\n    }\n    if(k[i]<that.proposer[i].length&&that.val[i].validator[j].validator_index==that.proposer[i][k[i]])\n    v_line[j].node[i].ispro=1;\n   }\n}\nconsole.log(v_line);\nvar epoch_0=that.val[0].epoch;\nfor(let i=0;i<slashed.length;i++){\n     for(let j=0;j<v_line.length;j++){\n        let epoch=Math.floor(slashed[i].slot/32);\n       \n      \n       if(slashed[i].V_index==v_line[j].index&&epoch>=epoch_0&&epoch<epoch_0+that.val.length){\n         v_line[j].node[epoch-epoch_0].isslashed=1;\n       }\n     }\n}\n\n// console.log(proposer);\n// console.log(graph);\nconsole.log(v_line);\n\n    var data_rect=[];\n   for(let i=0;i<graph.length;i++){\n       for(let j=0;j<graph[i].length;j++){\n        data_rect.push({i:i,j:j,size:graph[i][j]})\n       }\n   }\n\n //设置矩阵的行列\nvar c=that.val.length;\n\nconst yValue=['Unvoted validator','Incorrect voted validator','Incorrect voted proposer','Continuous irregular','Slashed validator'];\nconst xValue=[];\nfor(let i=0;i<c;i++){\n    xValue.push(i == 0?'epoch:'+ that.val[i].epoch:that.val[i].epoch);\n}\n\n\nvar legend = g.selectAll(\".legend\")\n        .data(yValue)\n        .enter().append(\"g\")\n        .attr(\"class\", \"legend\")\n        .attr(\"transform\", function (d, i) { return \"translate(\" + (4+i *95) + \",\" +(that.margin.top+that.innerHeight+20) + \")\"; });\n      legend.append(\"rect\")\n        .data(yValue)\n        .attr(\"x\", function(d,i){return i?-20:0})\n        .attr(\"y\", d=>d=='Continuous irregular'?5:3)\n        .attr(\"width\", 10)\n        .attr(\"height\", d=>d=='Continuous irregular'?1:4)\n        .style(\"fill\",function(d){\n            switch (d){\n                case 'Incorrect voted validator':return 'red';\n                case 'Unvoted validator':return 'grey';\n                case 'Incorrect voted proposer':return '#6E00F5';\n                case 'Continuous irregular':return '#BFC9CA';\n                case 'Slashed validator':return 'black';\n            }\n        })\n        .attr('opacity',d=>d=='Continuous irregular'?0.7:0.8);\n\n      legend.append(\"text\")\n        .data(yValue)\n        .attr('class', 'legend_text')\n        .attr(\"x\", function(d,i){return i?-8:12})\n        .attr(\"y\", d=>d=='Continuous irregular'?-2:3)\n        .attr(\"dy\", \".5em\")\n        .attr(\"fill\", 'black')\n        .style(\"text-anchor\", \"start\")\n        .text(d => d )\n         .attr('font-size','6px');\n        \n      g.append('text')\n        .text('voting')\n        .attr('transform', `translate(${300},${308})`)\n        .attr('font-size','6px')\n\n//设置坐标轴\nconst xscale = d3.scaleBand()\n        .domain(xValue)\n        .range([0, that.innerWidth]);\n\n const xscale2 = d3.scaleLinear()\n        .domain([0,c])\n        .range([0, that.innerWidth]);\n\nconst yscale2 = d3.scaleLinear() \n        .domain([0,1])\n        .range([0,that.innerHeight])\n// const yaxis = d3.axisLeft(yscale)\n//         .ticks(r)\n//         .tickSize(10)\n//         .tickPadding(10)\nconst xaxis = d3.axisTop(xscale)\n        .ticks(c)\n        .tickSize(-3)\n        .tickPadding(-15);\n// g.append('g').call(yaxis)\n//         .attr('id' ,'yaxis') \n//         .style(\"font-size\",\"24px\");\n \ng.append('g').call(xaxis)\n        .attr('id', 'xaxis')\n        .attr('transform', `translate(0, ${that.innerHeight})`)\n        .style(\"font-size\",\"10px\");\n//添加矩阵\n\nconst  rect_width=that.innerWidth/(5*c);\nconst  sub_width=that.innerWidth/c-rect_width;\nconst   rect_height_I=that.innerHeight/SUM;\n\nvar x1=[];\nvar x2=[];\nfor(let j=0;j<that.val.length-1;j++){\n       x1.push((j+1)*rect_width+j*sub_width+sub_width/2);\n       x2.push((j+1)*rect_width+(j+1)*sub_width+sub_width/2);\n  }\n\n\n  function  make_line(i){\n    var isred=0;\n      var Y=[];\n      var y1=[];\n      var y2=[];\n      for(let j=0;j<that.val.length;j++){\n        var h;\n        rect_height_I*v_line[i].node[j].dy+yscale2(v_line[i].node[j].y);\n        if(v_line[i].node[j].y==2)\n            h=0;\n        else if(v_line[i].node[j].y==0)\n            h=rect_height_I*v_line[i].node[j].dy+yscale2(v_line[i].node[j].y)+(SUM-graph[j][0]-graph[j][1])*rect_height_I;\n        else \n           h=rect_height_I*v_line[i].node[j].dy+yscale2(v_line[i].node[j].y)-graph[j][1]*rect_height_I;\n        Y.push(h);\n        if(j<that.val.length-1)\n        y1.push(h);\n        if(j)\n        y2.push(h);\n    }\n    var path=d3.path();\n    for(let j=0;j<y1.length;j++){\n     \n       if((v_line[i].node[j+1].y==1||v_line[i].node[j+1].y==0)&&(v_line[i].node[j].y==0||v_line[i].node[j].y==1)){\n        isred=isred||v_line[i].node[j].y;\n        // var dx=(x2[j]-x1[j])/20;\n        // var dy=(y2[j]-y1[j])/3;\n        // let cpx1 = x1[j] + dx;\n        // let cpy1 = y1[j] + dy;\n        // let cpx2 = x2[j] - dx;\n        // let cpy2 = y2[j] - dy;\n        path.moveTo(x1[j],y1[j]);\n        //path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,x2[j],y2[j]);  //曲线\n        path.lineTo(x2[j],y2[j]);                                //直线\n       }\n\n    }\n   // console.log(path);\n    g.append('path')\n            .attr('d', path.toString())\n            .attr('class', isred?'v_line_r':'v_line_g')\n            .style('stroke',isred?'red':'#BFC9CA ')\n            .style('stroke-width','0.8')//'0.5')\n            .style('fill','none')\n            .style('opacity',0.7)\n            .on('mouseover',function(){\n             \n             this.style.stroke='#FF66CC';\n             d3.select(this).style(\"stroke-width\",'1.5')\n             this.style.opacity=1;\n             //d3.select(this)\n              // .style('z-index',999)\n      \n            var x='validator_index: '+v_line[i].index;\n            d3.selectAll('.tooltip3')\n              .html(x)\n              .style(\"opacity\",1.0)\n\n            //  tooltip.html(x)\n            //         .style(\"opacity\",1.0);\n            })\n            .on('mouseleave',function(){\n             this.style.stroke=isred?'red':'#BFC9CA ';\n             this.style.opacity=0.7;\n             d3.selectAll('.tooltip3').style(\"opacity\",0);\n\n            })\n        }\n\n\n\n      function  make_rect(i){\n        for(let j=0;j<v_line[i].node.length;j++){\n          if(v_line[i].node[j].y!=2){\n            var y=v_line[i].node[j].y;\n            var dy=v_line[i].node[j].dy;\n            g.append('rect')\n            .attr('class','v_rect')\n            .attr('width',rect_width)\n            .attr('height', rect_height_I*0.8)\n            .attr('y',function(){\n                var ans;\n                if(!y)\n                ans= (yscale2(y))+(dy-1)*rect_height_I+(SUM-graph[j][0]-graph[j][1])*rect_height_I;\n                else\n                ans=yscale2(y)-graph[j][1]*rect_height_I+(dy-1)*rect_height_I;\n                return ans;\n            })\n            .attr('x',xscale2(j)+sub_width/2)\n            .attr('fill',function(){\n                if(v_line[i].node[j].isslashed)\n                return 'black';\n                else if(v_line[i].node[j].ispro)\n                return '#6E00F5'\n                else if(!y)\n                return '#4D5656';\n                else \n                return 'red';\n            })\n            .attr('opacity',(v_line[i].node[j].ispro||v_line[i].node[j].isslashed)?1:0.8)\n            .style('stroke',function(){\n              if(v_line[i].node[j].isslashed) \n                  return 'black';\n              if(v_line[i].node[j].ispro)\n               return '#9900CC';//#6E00F5';\n              return 'none';\n            })\n            .style('stroke-width',v_line[i].node[j].ispro||v_line[i].node[j].isslashed?'0.5':'none')\n          }\n         }\n        }\n     for(let i=0;i< v_line.length;i++){\n      make_rect(i);\n    }\n    \n    var ISred=[];\n    // for(let i=0;i< v_line.length;i++){\n    //     var isred=0;\n    //    for(let j=0;j<v_line[i].length-1;j++){\n    //    if((v_line[i].node[j+1].y==1||v_line[i].node[j+1].y==0)&&(v_line[i].node[j].y==0||v_line[i].node[j].y==1)){\n    //       isred=isred||v_line[i].node[j].y;\n    //       console.log(isred);\n    //       if(isred)\n    //       break;\n    //    }\n      \n    // }\n    // if(isred){\n    //    ISred.push(i);\n    // }else{\n    //    make_line(i);\n    //   }\n    // }\n\n     for(let i=0;i< v_line.length;i++){\n      let isred=0;\n        for(let j=0;j<v_line[i].node.length-1;j++){\n        if((v_line[i].node[j+1].y==1||v_line[i].node[j+1].y==0)&&(v_line[i].node[j].y==0||v_line[i].node[j].y==1)){\n           isred=isred||v_line[i].node[j].y;\n        if(isred)\n         break;\n      }\n    }\n    if(isred)\n      ISred.push(i);\n      else\n        make_line(i);\n}\n  console.log(ISred);\n    for(let i=0;i<ISred.length;i++)\n    make_line(ISred[i]);\n   \n\n  }\n   },\n  created(){\n\n  },\n  watch:{\n    message(){\n        d3.select('#Validator').selectAll('g').remove()\n        this.getValidator();\n        console.log(\"draw\");\n        \n      },\n      vali(){\n      // for(let i=0;i< v_line.length;i++){\n      //  this.make_line(i);\n      //  this.make_rect(i);\n      // }\n      this. data_processing();\n    }\n    }\n}\n</script>\n<style>\n .axis text{\n  font-family: sans-serif;\n  font-size: 11px;\n}\n\n.v_line_r{\n  z-index:999;\n  stroke-width:5px;\n}\n\n.v_line_g{\n  z-index:990;\n}\n\n.tooltip3{\n  position:absolute;\n  stroke:black;\n  left:850px;\n  top:280px;\n  width:auto;\n  height:auto;\n  border:1px solid lightcoral;\n  border-radius:5px;\n  padding-left:5px;\n  padding-right:5px;\n  padding-top:5px;\n  padding:5px;\n  background-color: white;\n  font-size: 12px;\n  text-align: center;\n  opacity:0;\n}\n\n.panel-header_val {\n  position: absolute;\n  left:818px;\n  top:250px;\n  padding: 0px 5px;\n  width: 75px;\n  height: 18px;\n  line-height: 18px;\n  font-size: 8px;\n  text-align: left;\n  background: #415c68;\n  color: #fcfcfc;\n  display: flex;\n  font-weight: bold;\n  border-radius: 1px;\n  box-shadow: 0 1px 2px rgba(26 26 26 0.2);\n  z-index:99;\n\n}\n\n.panel-header-end_val {\n  position: absolute;\n  top: 250px;\n  left: 903px;\n  border-top: 18px solid #455a64;\n  border-right: 18px solid #ffffff;\n  border-bottom: 0px solid #ffffff;\n  z-index:98;\n}\n</style>"],"sourceRoot":""}]}